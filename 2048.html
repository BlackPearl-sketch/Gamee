<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>2048 Custom Size</title>
<style>
  :root {
    --bg: #1b1f23;
    --accent: #ffcc00;
    --surface: #2a2f38;
    --text: #ffffff;
    --light-square: #e8defa;
    --dark-square: #3c1361;
    /* nav and button defaults */
    --nav-bg: var(--surface);
    --nav-text: var(--text);
    --primary: var(--accent);
    --button-bg: var(--accent);
    --button-text: var(--bg);
    /* 2048 colors fallback */
    --board-bg: #bbada0;
    --tile-bg: #cdc1b4;
  }
  /* Themes */
  .theme-dark {
    --bg: #1b1f23;
    --accent: #ffcc00;
    --surface: #2a2f38;
    --text: #ffffff;
    --board-bg: #3c1361;
    --tile-bg: #cdc1b4;
  }
  .theme-bright {
    --bg: #fafafa;
    --accent: #007bff;
    --surface: #ffffff;
    --text: #1a1a1a;
    --board-bg: #e8defa;
    --tile-bg: #ede0c8;
  }
  .theme-red {
    --bg: #2e0606;
    --accent: #ff4d4d;
    --surface: #501616;
    --text: #f9f9f9;
    --board-bg: #661111;
    --tile-bg: #bb6666;
  }

  body {
    font-family: 'Segoe UI', sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
    min-height: 100vh;
    transition: background 0.3s, color 0.3s;
  }
  /* Header */
  header {
    background: var(--nav-bg);
    color: var(--nav-text);
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 10;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    width: 100%;
    max-width: 1000px;
  }
  header h1 {
    font-family: 'Montserrat', sans-serif;
    color: var(--primary);
    cursor: pointer;
    margin: 0;
  }
  nav ul {
    list-style: none;
    display: flex;
    gap: 1.5rem;
    margin: 0;
    padding: 0;
  }
  nav ul li {
    cursor: pointer;
    font-weight: 600;
  }
  nav ul li:hover { color: var(--primary); }
  /* Theme Selector */
  .theme-toggle {
    background: var(--button-bg);
    color: var(--button-text);
    border: none;
    border-radius: 6px;
    padding: 0.4rem 0.6rem;
    font-size: 1rem;
    cursor: pointer;
  }
  .theme-toggle:hover { opacity: 0.9; }

  h1 {
    margin: 20px 0 10px;
    color: var(--primary);
    font-weight: 700;
    text-shadow: 0 0 8px var(--accent);
  }
  #controls {
    margin-top: 10px;
  }
  #game-container {
    background: var(--board-bg, #bbada0);
    border-radius: 10px;
    padding: 15px;
    display: grid;
    gap: 12px;
    box-shadow: 0 0 15px #ccc;
    margin-top: 15px;
    transition: background 0.3s;
  }
  .tile {
    background: var(--tile-bg, #cdc1b4);
    color: #776e65;
    font-weight: 700;
    font-size: 32px;
    width: 70px;
    height: 70px;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 6px;
    transition: background-color 0.25s ease, color 0.25s ease;
  }
  .tile-0  { background: var(--tile-bg, #cdc1b4); }
  .tile-2  { background: #eee4da;  color: #776e65; }
  .tile-4  { background: #ede0c8;  color: #776e65; }
  .tile-8  { background: #f2b179;  color: #f9f6f2; }
  .tile-16 { background: #f59563;  color: #f9f6f2; }
  .tile-32 { background: #f67c5f;  color: #f9f6f2; }
  .tile-64 { background: #f65e3b;  color: #f9f6f2; }
  .tile-128 { background: #edcf72; color: #f9f6f2; }
  .tile-256 { background: #edcc61; color: #f9f6f2; }
  .tile-512 { background: #edc850; color: #f9f6f2; }
  .tile-1024 { background: #edc53f; color: #f9f6f2; }
  .tile-2048 { background: #edc22e; color: #f9f6f2; }
  #scoreboard, #boxcount {
    margin-top: 10px;
    font-weight: 700;
    font-size: 18px;
    color: #776e65;
  }
  #message {
    margin-top: 15px;
    font-size: 20px;
    font-weight: 700;
    color: #776e65;
  }
  button, input {
    padding: 8px 12px;
    font-size: 16px;
    margin: 5px;
  }
  button {
    border: none;
    background: var(--button-bg);
    color: var(--button-text);
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
  }
  button:hover { background: #9c8576; }
</style>
</head>
<body class="theme-dark">
  <header>
    <h1 onclick="window.location.href='home.html'">GameHub</h1>
    <nav>
      <ul>
        <li onclick="window.location.href='home.html'">Home</li>
        <li onclick="window.location.href='brain.html'">Puzzle Games</li>
      </ul>
    </nav>
    <select class="theme-toggle" onchange="changeTheme(this.value)">
      <option value="theme-dark">ðŸŒ‘ Dark</option>
      <option value="theme-bright">ðŸŒž Bright</option>
      <option value="theme-red">ðŸ”´ Red</option>
    </select>
  </header>

  <h1>2048 Custom Grid</h1>
  <div id="controls">
    <label>Grid Size: 
      <input type="number" id="gridSize" value="4" min="3" max="8">
    </label>
    <button id="startBtn">Start Game</button>
  </div>
  <div id="game-container" aria-label="2048 game board" role="grid" tabindex="0"></div>
  <div id="scoreboard">Score: 0</div>
  <div id="boxcount">Box Count: 0</div>
  <div id="message"></div>
  <button id="restartBtn">Restart Game</button>
  <script>
    let size = 4;
    let board = [];
    let score = 0;
    const maxTile = 2048;

    const container = document.getElementById('game-container');
    const scoreboard = document.getElementById('scoreboard');
    const boxcount = document.getElementById('boxcount');
    const message = document.getElementById('message');
    const restartBtn = document.getElementById('restartBtn');
    const startBtn = document.getElementById('startBtn');
    const gridSizeInput = document.getElementById('gridSize');

    function initBoard() {
      board = Array.from({ length: size }, () => Array(size).fill(0));
      score = 0;
      message.textContent = '';
      addRandomTile();
      addRandomTile();
      updateUI();
    }

    function addRandomTile() {
      const empty = [];
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (board[r][c] === 0) empty.push([r, c]);
        }
      }
      if (empty.length === 0) return;
      const [r, c] = empty[Math.floor(Math.random() * empty.length)];
      board[r][c] = Math.random() < 0.9 ? 2 : 4;
    }

    function updateUI() {
      container.innerHTML = '';
      container.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
      let count = 0;
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          const tile = document.createElement('div');
          let val = board[r][c];
          tile.classList.add('tile', 'tile-' + val);
          tile.textContent = val || '';
          if (val !== 0) count++;
          container.appendChild(tile);
        }
      }
      scoreboard.textContent = 'Score: ' + score;
      boxcount.textContent = 'Box Count: ' + count;
    }

    function canMove() {
      for (let r = 0; r < size; r++) {
        for (let c = 0; c < size; c++) {
          if (board[r][c] === 0) return true;
          if (c < size - 1 && board[r][c] === board[r][c + 1]) return true;
          if (r < size - 1 && board[r][c] === board[r + 1][c]) return true;
        }
      }
      return false;
    }

    function isWin() {
      return board.flat().includes(maxTile);
    }

    function slideAndMerge(row) {
      let arr = row.filter(v => v !== 0);
      for (let i = 0; i < arr.length - 1; i++) {
        if (arr[i] === arr[i + 1]) {
          arr[i] *= 2;
          score += arr[i];
          arr[i + 1] = 0;
        }
      }
      arr = arr.filter(v => v !== 0);
      while (arr.length < size) arr.push(0);
      return arr;
    }

    function moveLeft() {
      let moved = false;
      for (let r = 0; r < size; r++) {
        let newRow = slideAndMerge(board[r]);
        for (let c = 0; c < size; c++) {
          if (board[r][c] !== newRow[c]) moved = true;
          board[r][c] = newRow[c];
        }
      }
      return moved;
    }

    function rotate() {
      let newBoard = [];
      for (let c = 0; c < size; c++) {
        newBoard.push([]);
        for (let r = size - 1; r >= 0; r--) {
          newBoard[c].push(board[r][c]);
        }
      }
      board = newBoard;
    }

    function moveUp() {
      rotate();
      let moved = moveLeft();
      rotate(); rotate(); rotate();
      return moved;
    }

    function moveRight() {
      rotate(); rotate();
      let moved = moveLeft();
      rotate(); rotate();
      return moved;
    }

    function moveDown() {
      rotate(); rotate(); rotate();
      let moved = moveLeft();
      rotate();
      return moved;
    }

    function handleInput(key) {
      let moved = false;
      switch (key) {
        case 'ArrowLeft': moved = moveLeft(); break;
        case 'ArrowRight': moved = moveRight(); break;
        case 'ArrowUp': moved = moveUp(); break;
        case 'ArrowDown': moved = moveDown(); break;
      }
      if (moved) {
        addRandomTile();
        updateUI();
        if (isWin()) message.textContent = 'ðŸŽ‰ You Win!';
        else if (!canMove()) message.textContent = 'Game Over!';
      }
    }

    window.addEventListener('keydown', e => {
      if (message.textContent) return;
      handleInput(e.key);
    });

    restartBtn.addEventListener('click', initBoard);
    startBtn.addEventListener('click', () => {
      size = parseInt(gridSizeInput.value);
      initBoard();
    });

    // Theme Handling (identical to chess game)
    function changeTheme(themeName) {
      document.body.classList.remove('theme-dark', 'theme-bright', 'theme-red');
      document.body.classList.add(themeName);
    }
    // Default theme and board
    initBoard();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bridge Builder</title>
<style>
  :root {
    --accent: #ffd166;
    --bg1: #cbe4ff;
    --bg2: #a0d9ff;
    --card: rgba(255, 255, 255, 0.8);
  }
  body {
    margin: 0;
    background: linear-gradient(180deg, var(--bg1), var(--bg2));
    font-family: Arial, sans-serif;
    color: #333;
    min-height: 100vh;
  }

  header {
    background: #2a2f38;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 2rem;
    padding: 1rem 2rem;
    width: 100%;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 10;
  }
  header h1 {
    font-family: 'Montserrat', Arial, sans-serif;
    color: #ffcc00;
    cursor: pointer;
    margin: 0;
  }
  nav ul {
    list-style: none;
    display: flex;
    gap: 1.5rem;
    margin: 0;
    padding: 0;
  }
  nav ul li {
    cursor: pointer;
    font-weight: 600;
  }
  nav ul li:hover {
    color: #ffcc00;
  }
  .theme-btn {
    background: var(--accent);
    color: #222;
    border: none;
    border-radius: 6px;
    padding: 0.4rem 0.8rem;
    font-size: 1rem;
    cursor: pointer;
    font-weight: bold;
  }
  .theme-btn:hover {
    opacity: 0.9;
  }

  main {
    text-align: center;
    padding: 1rem;
  }

  #gameCanvas {
    background: var(--bg2);
    display: block;
    margin: 1rem auto;
    border: 3px solid #333;
    border-radius: 12px;
  }

  #levelDisplay {
    font-weight: bold;
    font-size: 20px;
    margin-top: 0;
  }

  #instructions {
    margin-bottom: 10px;
    font-size: 14px;
    font-style: italic;
    color: #444;
  }

  #message {
    margin-top: 12px;
    font-weight: bold;
    font-size: 18px;
    color: #007700;
  }
</style>
</head>
<body>
<header>
  <h1 onclick="window.location.href='home.html'">GameHub</h1>
  <nav>
    <ul>
      <li onclick="window.location.href='home.html'">Home</li>
      <li onclick="window.location.href='brain.html'">Construction Games</li>
    </ul>
  </nav>
  <button class="theme-btn" id="themeBtn">Theme: Light</button>
</header>

<main>
  <h2 id="levelDisplay">Level 1</h2>
  <p id="instructions">Click to place bridge segments between the two cliffs!</p>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <p id="message"></p>
</main>

<script>
(() => {
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");
  const levelDisplay = document.getElementById("levelDisplay");
  const message = document.getElementById("message");
  const themeBtn = document.getElementById("themeBtn");

  let bridge = [];
  let segmentLength = 40;
  let startX, startY, targetX, targetY;
  let gameOver = false;
  let animationInProgress = false;
  let currentLevel = 1;
  const maxLevel = 5;

  function initializeLevel(level) {
    gameOver = false;
    animationInProgress = false;
    bridge = [];

    // Vary starting and target cliff positions and segmentLength based on level
    const cliffWidth = 150;
    startX = 100;
    startY = 300;
    targetX = 500 + (level - 1) * 20; // bridges get longer horizontally
    targetY = 300 - (level - 1) * 10; // slight vertical change

    // Segment length shorter for higher levels for more challenge
    segmentLength = 40 - (level - 1) * 5;
    if (segmentLength < 15) segmentLength = 15;

    levelDisplay.textContent = `Level ${level}`;
    message.textContent = "";
  }

  function drawCliffs() {
    ctx.fillStyle = "#654321";
    ctx.fillRect(0, startY, 150, 100); // left cliff
    ctx.fillRect(targetX - 50, targetY, 150, 100); // right cliff
  }

  function drawBridge() {
    if (bridge.length === 0) return;
    ctx.strokeStyle = "#444";
    ctx.lineWidth = 5;
    ctx.beginPath();
    ctx.moveTo(startX, startY);
    for (let seg of bridge) {
      ctx.lineTo(seg.x, seg.y);
    }
    ctx.stroke();
  }

  function drawTargetFlag() {
    ctx.fillStyle = "red";
    ctx.fillRect(targetX - 5, targetY - 40, 10, 40);
    ctx.beginPath();
    ctx.moveTo(targetX + 5, targetY - 40);
    ctx.lineTo(targetX + 35, targetY - 25);
    ctx.lineTo(targetX + 5, targetY - 10);
    ctx.closePath();
    ctx.fill();
  }

  // Animate the placement of the next bridge segment smoothly
  function animateSegmentPlacement(startPoint, endPoint, onComplete) {
    let progress = 0;
    const animationDuration = 300; // milliseconds
    const startTime = performance.now();

    function animate() {
      const now = performance.now();
      progress = (now - startTime) / animationDuration;
      if (progress > 1) progress = 1;

      // Clear and redraw scene
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawCliffs();

      // Draw existing bridge up to last segment, exclude the last since animating
      ctx.strokeStyle = "#444";
      ctx.lineWidth = 5;
      ctx.beginPath();
      ctx.moveTo(startX, startY);
      for (let i = 0; i < bridge.length - 1; i++) {
        ctx.lineTo(bridge[i].x, bridge[i].y);
      }
      // draw the animating segment partially
      const interpX = startPoint.x + (endPoint.x - startPoint.x) * progress;
      const interpY = startPoint.y + (endPoint.y - startPoint.y) * progress;
      ctx.lineTo(interpX, interpY);
      ctx.stroke();

      drawTargetFlag();

      if (progress < 1) {
        requestAnimationFrame(animate);
      } else {
        onComplete();
      }
    }

    requestAnimationFrame(animate);
  }

  function checkWin() {
    if (bridge.length > 0) {
      const lastSeg = bridge[bridge.length - 1];
      const dx = lastSeg.x - targetX;
      const dy = lastSeg.y - targetY;
      if (Math.sqrt(dx * dx + dy * dy) < segmentLength) {
        message.textContent = "You connected the bridge! ðŸŽ‰";
        gameOver = true;
        return true;
      }
    }
    return false;
  }

  // Handle user click
  canvas.addEventListener("click", e => {
    if (gameOver || animationInProgress) return;

    const lastPoint = bridge.length > 0 ? bridge[bridge.length - 1] : {x: startX, y: startY};
    const angle = Math.atan2(targetY - lastPoint.y, targetX - lastPoint.x);

    const newPoint = {
      x: lastPoint.x + segmentLength * Math.cos(angle),
      y: lastPoint.y + segmentLength * Math.sin(angle)
    };

    animationInProgress = true;
    bridge.push(newPoint);

    animateSegmentPlacement(lastPoint, newPoint, () => {
      animationInProgress = false;
      if (checkWin()) {
        // Wait a bit then advance level
        setTimeout(() => {
          if (currentLevel < maxLevel) {
            currentLevel++;
            initializeLevel(currentLevel);
          } else {
            message.textContent = "You've completed all levels! ðŸŽ‰";
          }
        }, 1500);
      }
    });
  });

  function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawCliffs();
    drawBridge();
    drawTargetFlag();
    requestAnimationFrame(update);
  }

  themeBtn.addEventListener("click", () => {
    if(document.body.classList.contains("dark")) {
      document.body.classList.remove("dark");
      document.body.classList.add("bright");
      themeBtn.textContent = "Theme: Bright";
    } else {
      document.body.classList.remove("bright");
      document.body.classList.add("dark");
      themeBtn.textContent = "Theme: Dark";
    }
  });

  // Initialize first level and start animation loop
  initializeLevel(currentLevel);
  update();

})();
</script>
</body>
</html>
